#!/bin/sh
set -e

#
# This script is run by mygrate before up.sql is executed
#

PATH=../../node_modules/.bin:$PATH

browserify -t coffeeify --extension=".coffee" --bare ../../plv8/index.js > bundle.js

# Create the single file up.sql required by mygrate
cat << EOF > up.sql
/*
 * DO NOT EDIT. THIS FILE IS AUTOGENERATED BY prehook.
 *
 * Edit up-header.sql, up-footer.sql or up-functions.sql instead.
 */

EOF
cat up-header.sql bundle.js up-footer.sql up-functions.sql >> up.sql
rm bundle.js

